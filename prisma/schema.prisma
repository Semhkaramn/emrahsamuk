generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Ana Ürün Tablosu
model Product {
  id               Int       @id @default(autoincrement())
  urunId           Int       @unique @map("urun_id")
  urunKodu         String?   @map("urun_kodu") @db.VarChar(100)
  barkodNo         String?   @map("barkod_no") @db.VarChar(50)
  eskiAdi          String?   @map("eski_adi") @db.Text
  yeniAdi          String?   @map("yeni_adi") @db.Text
  faturaAdi        String?   @map("fatura_adi") @db.Text
  url              String?   @db.VarChar(255)
  marka            String?   @db.VarChar(100)
  aciklama         String?   @db.Text
  durum            String?   @default("AKTIF") @db.VarChar(20)
  vitrinDurumu     String?   @map("vitrin_durumu") @db.VarChar(20)
  kargoOdeme       String?   @map("kargo_odeme") @db.VarChar(20)
  kdv              Decimal?  @db.Decimal(5, 2)
  desi             Decimal?  @db.Decimal(10, 2)
  stok             Int?      @default(0)
  onDetay          String?   @map("on_detay") @db.Text
  sira             Int?      @default(0)
  ozelKod1         String?   @map("ozel_kod_1") @db.VarChar(100)
  ozelKod2         String?   @map("ozel_kod_2") @db.VarChar(100)
  ozelKod3         String?   @map("ozel_kod_3") @db.VarChar(100)
  kategoriId       Int?      @map("kategori_id")
  depoYerKodu      String?   @map("depo_yer_kodu") @db.VarChar(100)
  ureticiKodu      String?   @map("uretici_kodu") @db.VarChar(100)
  gtip             String?   @db.VarChar(50)
  modelKodu        String?   @map("model_kodu") @db.VarChar(100)
  processingStatus String?   @default("pending") @map("processing_status") @db.VarChar(20)
  processedAt      DateTime? @map("processed_at")
  uploadedAt       DateTime? @map("uploaded_at")
  createdAt        DateTime  @default(now()) @map("created_at")
  updatedAt        DateTime  @updatedAt @map("updated_at")

  // İlişkiler
  prices     ProductPrice?
  categories ProductCategory?
  seo        ProductSeo?

  @@index([urunId])
  @@index([urunKodu])
  @@index([durum])
  @@index([processingStatus])
  @@index([processedAt])
  @@index([uploadedAt])
  @@map("products")
}

// Fiyatlar Tablosu
model ProductPrice {
  id               Int      @id @default(autoincrement())
  urunId           Int      @unique @map("urun_id")
  piyasaFiyat      Decimal? @map("piyasa_fiyat") @db.Decimal(12, 2)
  alisFiyat        Decimal? @map("alis_fiyat") @db.Decimal(12, 2)
  hizliFiyat       Decimal? @map("hizli_fiyat") @db.Decimal(12, 2)
  siteFiyat        Decimal? @map("site_fiyat") @db.Decimal(12, 2)
  siteDoviz        String?  @default("TL") @map("site_doviz") @db.VarChar(10)
  n11Fiyat         Decimal? @map("n11_fiyat") @db.Decimal(12, 2)
  n11Doviz         String?  @default("TL") @map("n11_doviz") @db.VarChar(10)
  hbFiyat          Decimal? @map("hb_fiyat") @db.Decimal(12, 2)
  hbDoviz          String?  @default("TL") @map("hb_doviz") @db.VarChar(10)
  pttFiyat         Decimal? @map("ptt_fiyat") @db.Decimal(12, 2)
  pttDoviz         String?  @default("TL") @map("ptt_doviz") @db.VarChar(10)
  amazonTrFiyat    Decimal? @map("amazon_tr_fiyat") @db.Decimal(12, 2)
  amazonTrDoviz    String?  @default("TL") @map("amazon_tr_doviz") @db.VarChar(10)
  trendyolFiyat    Decimal? @map("trendyol_fiyat") @db.Decimal(12, 2)
  trendyolDoviz    String?  @default("TL") @map("trendyol_doviz") @db.VarChar(10)
  cicekSepetiFiyat Decimal? @map("ciceksepeti_fiyat") @db.Decimal(12, 2)
  cicekSepetiDoviz String?  @default("TL") @map("ciceksepeti_doviz") @db.VarChar(10)
  modanisaFiyat    Decimal? @map("modanisa_fiyat") @db.Decimal(12, 2)
  modanisaDoviz    String?  @default("TL") @map("modanisa_doviz") @db.VarChar(10)
  pazaramaFiyat    Decimal? @map("pazarama_fiyat") @db.Decimal(12, 2)
  pazaramaDoviz    String?  @default("TL") @map("pazarama_doviz") @db.VarChar(10)
  farmazonFiyat    Decimal? @map("farmazon_fiyat") @db.Decimal(12, 2)
  farmazonDoviz    String?  @default("TL") @map("farmazon_doviz") @db.VarChar(10)
  idefixFiyat      Decimal? @map("idefix_fiyat") @db.Decimal(12, 2)
  idefixDoviz      String?  @default("TL") @map("idefix_doviz") @db.VarChar(10)
  lcwFiyat         Decimal? @map("lcw_fiyat") @db.Decimal(12, 2)
  lcwDoviz         String?  @default("TL") @map("lcw_doviz") @db.VarChar(10)
  // Bayi fiyatları
  bayiFiyati1      Decimal? @map("bayi_fiyati_1") @db.Decimal(12, 2)
  bayiFiyati2      Decimal? @map("bayi_fiyati_2") @db.Decimal(12, 2)
  bayiFiyati3      Decimal? @map("bayi_fiyati_3") @db.Decimal(12, 2)
  bayiFiyati4      Decimal? @map("bayi_fiyati_4") @db.Decimal(12, 2)

  // İlişki
  product Product @relation(fields: [urunId], references: [urunId], onDelete: Cascade)

  @@index([urunId])
  @@map("product_prices")
}

// Kategoriler Tablosu
model ProductCategory {
  id            Int     @id @default(autoincrement())
  urunId        Int     @unique @map("urun_id")
  // Eski (Orijinal) Kategoriler
  anaKategori   String? @map("ana_kategori") @db.VarChar(100)
  altKategori1  String? @map("alt_kategori_1") @db.VarChar(100)
  altKategori2  String? @map("alt_kategori_2") @db.VarChar(100)
  altKategori3  String? @map("alt_kategori_3") @db.VarChar(100)
  altKategori4  String? @map("alt_kategori_4") @db.VarChar(100)
  altKategori5  String? @map("alt_kategori_5") @db.VarChar(100)
  altKategori6  String? @map("alt_kategori_6") @db.VarChar(100)
  altKategori7  String? @map("alt_kategori_7") @db.VarChar(100)
  altKategori8  String? @map("alt_kategori_8") @db.VarChar(100)
  altKategori9  String? @map("alt_kategori_9") @db.VarChar(100)

  // Yeni (AI ile belirlenen) Kategoriler
  yeniAnaKategori   String? @map("yeni_ana_kategori") @db.VarChar(100)
  yeniAltKategori1  String? @map("yeni_alt_kategori_1") @db.VarChar(100)
  yeniAltKategori2  String? @map("yeni_alt_kategori_2") @db.VarChar(100)
  yeniAltKategori3  String? @map("yeni_alt_kategori_3") @db.VarChar(100)
  yeniAltKategori4  String? @map("yeni_alt_kategori_4") @db.VarChar(100)
  yeniAltKategori5  String? @map("yeni_alt_kategori_5") @db.VarChar(100)
  yeniAltKategori6  String? @map("yeni_alt_kategori_6") @db.VarChar(100)
  yeniAltKategori7  String? @map("yeni_alt_kategori_7") @db.VarChar(100)
  yeniAltKategori8  String? @map("yeni_alt_kategori_8") @db.VarChar(100)
  yeniAltKategori9  String? @map("yeni_alt_kategori_9") @db.VarChar(100)

  // AI ham kategori çıktısı
  aiKategori    String? @map("ai_kategori") @db.VarChar(255)
  // Kategori işleme durumu
  processingStatus String? @default("pending") @map("processing_status") @db.VarChar(20)
  processedAt   DateTime? @map("processed_at")

  // İlişki
  product Product @relation(fields: [urunId], references: [urunId], onDelete: Cascade)

  @@index([urunId])
  @@index([anaKategori])
  @@index([yeniAnaKategori])
  @@index([processingStatus])
  @@map("product_categories")
}

// SEO Bilgileri Tablosu
model ProductSeo {
  id              Int     @id @default(autoincrement())
  urunId          Int     @unique @map("urun_id")
  seoBaslik       String? @map("seo_baslik") @db.Text
  seoAciklama     String? @map("seo_aciklama") @db.Text
  seoKeywords     String? @map("seo_keywords") @db.Text
  seoUrl          String? @map("seo_url") @db.VarChar(255)

  // İlişki
  product Product @relation(fields: [urunId], references: [urunId], onDelete: Cascade)

  @@index([urunId])
  @@map("product_seo")
}

// Sistem Ayarları Tablosu
model Settings {
  id          Int      @id @default(autoincrement())
  key         String   @unique @db.VarChar(100)
  value       String?  @db.Text
  description String?  @db.Text
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@map("settings")
}

// Arka Plan İşleri Tablosu
model BackgroundJob {
  id            Int       @id @default(autoincrement())
  jobType       String    @map("job_type") @db.VarChar(50) // category_processing, seo_processing
  status        String    @default("pending") @db.VarChar(20) // pending, running, paused, completed, failed, cancelled
  totalItems    Int       @default(0) @map("total_items")
  processedItems Int      @default(0) @map("processed_items")
  successCount  Int       @default(0) @map("success_count")
  errorCount    Int       @default(0) @map("error_count")

  // İş konfigürasyonu (JSON)
  config        String?   @db.Text // JSON: { urunIds: [...], etc. }

  // Sonuçlar ve hatalar
  lastError     String?   @map("last_error") @db.Text
  results       String?   @db.Text // JSON: işlem sonuçları

  // Zamanlar
  startedAt     DateTime? @map("started_at")
  pausedAt      DateTime? @map("paused_at")
  completedAt   DateTime? @map("completed_at")
  lastActivityAt DateTime? @map("last_activity_at")
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")

  @@index([jobType])
  @@index([status])
  @@index([createdAt])
  @@map("background_jobs")
}
